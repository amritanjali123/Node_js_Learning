"use strict";
const diskStorage = require("./diskStorage");
const createMiddleware = require("./createMiddleware");

function Multer(options) {
  this.storage = options.storage;
}

Multer.prototype._createMiddleware = function(fields, strategy) {
  function setup() {
    return {
      fieldname: fields.name,
      limits: fields.maxcount,
      storage: this.storage,
      strategy: strategy
    };
  }
  return createMiddleware(setup.bind(this));
};
Multer.prototype.single = function(fieldname) {
  return this._createMiddleware({ name: fieldname, maxcount: 1 }, "Single");
};
Multer.prototype.array = function(fieldname, maxcount) {
  return this._createMiddleware(
    { name: fieldname, maxcount: maxcount },
    "Array"
  );
};

function multer(options) {
  return new Multer(options);
}

module.exports = multer;
module.exports.diskStorage = diskStorage;
